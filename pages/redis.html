Redis — SBAB Docs  documentation SBAB Docs Ansible Controller Ansible Roles Ansible Vault Argo Workflows Authentication & Authorization Bitbucket Boost Chatbot Booli Ceph Dex Fortigate troubleshooting Generate certificate Go GitHub Copilot GitLab @Sbab User Guide GitLab Maintenance Grafana Istio Java Jenkins Jenkinsfile Jmeter Kafka Maintenance Kafka @Sbab User Guide Kafka Connect Kubectl Access Kubernetes Lab environment Local Open Web Metrics infrastructure MongoDB Netbox NVIDIA Neo4J Sonatype Nexus repository Oracle OWASP Database OWASP @Sbab User Guide Pact Principles of Security Prometheus ReactJS Redis Redis-cli Docker Binary Application configuration Test sys locally Upgrade procedure Renovate S3 Security Guidelines for Developers Sentry Maintenance Sentry User Guide Configuring Variables for Services Deployed to Kubernetes Software Architecture SonarQube Maintenance SonarQube User Guide Structurizr System Landscape Vagrant Zipkin Windows Pipelines SBAB Docs » Redis View page source Redis ï Attention Redis at SBAB is a cache, NOT a persistent key-value database An application should never fail if data is not in Redis! Redis is deployed in a highly available configuration with Redis Sentinel. The amount of data in Redis is limited, when the limit is reached it will start dropping the least recently used (LRU) keys to make room for new data. TNT will sometimes flush all data from Redis, for instance during difficult maintenance or incidents if required. Redis-cli ï You can use redis-cli to communicate with SBABâs redis cache from you local machine (for testing). redis-cli can list keys, read values and more.
See https://redis.io/commands/ and https://redis.io/topics/quickstart Docker ï Login into the redis container on e.g. redis11 : docker exec - it redis / bin / bash Access redis-cli using the password from redis-vault.yml : redis - cli -- askpass Binary ï Install redis-cli on your local machine: curl --output redis.tar.gz http://download.redis.io/redis-stable.tar.gz
tar -xvzf redis.tar.gz cd redis-stable
make redis-cli
cp src/redis-cli /usr/local/bin/ Then connect like this: redis-cli -h <master-host ( redis_master_ip in ansible-repo ) > -p 6379 --askpass Now you can use commands like: KEYS security-service::*                                        To get all keys with security-service:: as prefix

GET security-service::69eef3bb-a1bf-49a9-9557-1d1e5f3d6743      To read the value connected to a key

TTL security-service::69eef3bb-a1bf-49a9-9557-1d1e5f3d6743      Get the remaining time-to-live Our redis cache is read-only so redis-cli commands like DEL wont work. Application configuration ï When configuring your application to use Redis it is important you use a Redis library with Redis Sentinel support. In a micro service your application will be provided with the following environment variables for Redis: Env variable Example value REDIS_MASTER_NAME mymaster REDIS_PASSWORD topsecretpassword REDIS_SENTINEL_NODES 1.1.1.1:26379,2.2.2.2:26379,3.3.3.3:26379 Note Applications MUST prefix their keys with SERVICENAME: ie.
the full path of a key should be something along the lines of: loan-payout-service:/users/9523/balance - keys without a SERVICENAME: prefix will be aggressively pruned Note Applications SHOULD set sensible TTL (Time-To-Live) on keys.
Keys without TTL or TTL greater than 7 days may be pruned Examples available in security-service and go-template . Test sys locally ï Redis in sys is available for testing from the office. To retrieve the necessary configuration, please look in the AFTO/ansible repository: grep redis_ inventories/ossys/group_vars/all/swarm.yml

ansible-vault view inventories/ossys/group_vars/all/redis-vault.yml Upgrade procedure ï Navigate to https://redis.io/download to find the latest stable version and the release notes Read the release note in case there are breaking changes Update defaults/main.yml to use the latest stable version Run the playbooks/deploy-redis-cluster.yml playbook for one server at the time, e.g: ansible - playbook -- inventory inventories / ossys playbooks / deploy - redis - cluster . yml -- limit redis11 Run sudo docker ps on the server to verify that both sentinel and redis containers are upgraded Use Redis-cli to check that Redis can be accessed, e.g: KEYS * Previous Next © Copyright 2024, TNT. Built with Sphinx using a theme provided by Read the Docs .