OWASP Database — SBAB Docs  documentation SBAB Docs Ansible Controller Ansible Roles Ansible Vault Argo Workflows Authentication & Authorization Bitbucket Boost Chatbot Booli Ceph Dex Fortigate troubleshooting Generate certificate Go GitHub Copilot GitLab @Sbab User Guide GitLab Maintenance Grafana Istio Java Jenkins Jenkinsfile Jmeter Kafka Maintenance Kafka @Sbab User Guide Kafka Connect Kubectl Access Kubernetes Lab environment Local Open Web Metrics infrastructure MongoDB Netbox NVIDIA Neo4J Sonatype Nexus repository Oracle OWASP Database Intro Automated routines Client usage Administrative tasks Deploying Deploy from scratch Trigger backup or OWASP update Restore from backup Minor OWASP update Major/breaking OWASP update OWASP @Sbab User Guide Pact Principles of Security Prometheus ReactJS Redis Renovate S3 Security Guidelines for Developers Sentry Maintenance Sentry User Guide Configuring Variables for Services Deployed to Kubernetes Software Architecture SonarQube Maintenance SonarQube User Guide Structurizr System Landscape Vagrant Zipkin Windows Pipelines SBAB Docs » OWASP Database View page source OWASP Database ï Intro ï We run a PostgreSQL database for OWASP in the Gitlab K8S cluster. CI/CD jobs performing OWASP scans of projects will connect to this database rather than create a local database copy. The git repository is here . Automated routines ï There are two Kubernetes CronJobs, one that updates the OWASP database every night and another that backups the database to Nexus. Client usage ï For CI/CD jobs in Gitlab, the database address, username and password are available in the environment variables: OWASP_DB_HOST OWASP_DB_USER OWASP_DB_PASSWORD For an example Maven configuration please see this file . Administrative tasks ï Deploying ï Either commit and push to master to run the pipeline or manually run the Ansible playbook, something like: ansible - playbook - i inventories / oscommon playbooks / deploy - k8s - helm - chart . yml \ - e "k8smaster=glb-m2-ki service_type=tools service_name=owasp-db service_namespace=owasp-db workspace_dir=/path/to/repo"" Make sure to set k8smaster and workspace_dir correctly, for the correct Gitlab K8S cluster and a directory containing the repo . Deploy from scratch ï Please note that initializing the database from scratch takes about two hours . There are some relevant settings in k8s/values.yaml that you need to consider. Normally the first couple of settings look like this: --- deployCLI : true doManualBackup : false doManualOWASPUpdate : false doRestoreFromBackup : false initializeDatabase : false If you are deploying from scratch, ie. there is no PostgreSQL instance - you should set: initializeDatabase : true And then deploy. For status check the relevant pods in namespace owasp-db in the Gitlab K8S cluster. Trigger backup or OWASP update ï Change the relevant setting in k8s/values.yaml : doManualBackup : false doManualOWASPUpdate : false And then deploy. For status check the relevant pods in namespace owasp-db in the Gitlab K8S cluster. Restore from backup ï If you choose to restore from backup when the database is empty/new you might need to manually create the âreadâ database user, review the scripts for details. Lets say your database is up and running but the nightly OWASP update messed things up. Since we execute the backup CronJob before the OWASP update CronJob you can restore from backup by setting: doRestoreFromBackup : true And deploy. Minor OWASP update ï Just set the appVersion in k8s/Chart.yaml : appVersion : "6.1.6" And if you want to perform the OWASP update immediately (rather than wait for the nightly CronJob) also set the below in k8s/values.yaml : doManualOWASPUpdate : true Then deploy. Major/breaking OWASP update ï You will probably want to deploy another instance in parallell if you donât want 2 hours downtime for pipelines utilizing the OWASP database. Set the desired OWASP version with appVersion in k8s/Chart.yaml : appVersion : "6.1.6" To deploy a new instance in parallell refer to âDeployingâ and change service_name and service_namespace . Then when the database is fully ready for use change the instance variable OWASP_DB_HOST in Gitlab to point to the new instance. Also update service_name and service_namespace in .gitlab-ci.yml so that future pipelines are updating the correct instance. Donât forget to cleanup the old instance (obviously set namespace and Helm release name correctly): helm - n owasp - db uninstall owasp - db kubectl - n owasp - db delete pvc postgres - owasp - db - postgres - owasp - db - 0 Previous Next © Copyright 2024, TNT. Built with Sphinx using a theme provided by Read the Docs .