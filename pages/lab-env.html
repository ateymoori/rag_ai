Lab environment — SBAB Docs  documentation SBAB Docs Ansible Controller Ansible Roles Ansible Vault Argo Workflows Authentication & Authorization Bitbucket Boost Chatbot Booli Ceph Dex Fortigate troubleshooting Generate certificate Go GitHub Copilot GitLab @Sbab User Guide GitLab Maintenance Grafana Istio Java Jenkins Jenkinsfile Jmeter Kafka Maintenance Kafka @Sbab User Guide Kafka Connect Kubectl Access Kubernetes Lab environment Cluster setup Prometheus & Grafana Installation DNS setup Deploy service Local Open Web Metrics infrastructure MongoDB Netbox NVIDIA Neo4J Sonatype Nexus repository Oracle OWASP Database OWASP @Sbab User Guide Pact Principles of Security Prometheus ReactJS Redis Renovate S3 Security Guidelines for Developers Sentry Maintenance Sentry User Guide Configuring Variables for Services Deployed to Kubernetes Software Architecture SonarQube Maintenance SonarQube User Guide Structurizr System Landscape Vagrant Zipkin Windows Pipelines SBAB Docs » Lab environment View page source Lab environment ï Cluster setup ï Run full deployment k8s ansible playbook, e.g. for ki: ansible-playbook --inventory inventories/oslab playbooks/k8s/full_deployment.yml \ --extra-vars primary_master = k8s-m1-ki \ --extra-vars parentgroup = k8s-ki \ --extra-vars mastergroup = k8smaster-ki \ --extra-vars workergroup = k8sworker-ki \ --extra-vars proxygroup = k8sproxy-ki Deploy Kafka: ansible-playbook --inventory inventories/oslab playbooks/deploy-kazoo.yml Deploy Zipkin: ansible-playbook -i inventories/oslab playbooks/deploy-zipkin.yml \
    --extra-vars 'image_tag=20230117110302-de6674b' \
    --extra-vars 'zipkin_version=2.23.18 Note No need to deploy Redis, Redis in ossys will be used. Prometheus & Grafana ï Installation ï Below steps needed if Prometheus and Grafana for oslab environment have been removed. Install promstack helm chart: ansible-playbook --inventory inventories/oslab playbooks/deploy-k8s-helm-chart.yml \ --extra-vars 'oscommon_target_env=lab service_type=tools service_name=promstack service_version=20210421074124-af460f7 service_repo=ssh://git@stash.sbab.se:7999/TNT/promstack.git service_branch=af460f7 network=null service_namespace=metrics-lab docs_api= docs_ui=' Deploy Grafana service for oslab : ansible-playbook --inventory inventories/oslab playbooks/deploy-k8s-service.yml \ --extra-vars 'oscommon_target_env=lab service_type=tools service_name=grafana service_version=20210419092259-1135773 service_repo=ssh://git@stash.sbab.se:7999/AFTO/grafana.git service_branch=TNT-3964 network=tools service_namespace=metrics-lab docs_api= docs_ui=' Note Check the Jenkins log for service_version and service_branch in above playbooks,
see Promstack and Grafana DNS setup ï Current DNS setup for ki , similar setup for uv can be added. Name Type Data FQDN grafana CNAME k8sproxy.common.sbab.se grafana.lab.sbab.se grafana-internal-ki CNAME k8sproxy-ki.lab.sbab.se grafana-internal-ki.lab.sbab.se prometheus CNMAE k8sproxy.common.sbab.se prometheus.lab.sbab.se prometheus-internal-ki CNAME k8sproxy-ki.lab.sbab.se prometheus-internal-ki.lab.sbab.se Deploy service ï spring-template service can be deployed to oslab using below playbook (just ki cluster): ansible-playbook --inventory inventories/oslab playbooks/deploy-k8s-service.yml \ --extra-vars 'cluster_name=ki service_scrape_path=/spring-template/admin/prometheusMetrics service_type=java16 service_name=spring-template service_version=20210415135817-80a1d1d service_repo=ssh://git@stash.sbab.se:7999/TNT/spring-template.git service_branch=80a1d1d network=backend service_namespace=backend docs_api= docs_ui=' Health check URL: http://k8sproxy-ki.lab.sbab.se:8080/spring-template/admin/healthcheck Previous Next © Copyright 2024, TNT. Built with Sphinx using a theme provided by Read the Docs .