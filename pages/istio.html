Istio — SBAB Docs  documentation SBAB Docs Ansible Controller Ansible Roles Ansible Vault Argo Workflows Authentication & Authorization Bitbucket Boost Chatbot Booli Ceph Dex Fortigate troubleshooting Generate certificate Go GitHub Copilot GitLab @Sbab User Guide GitLab Maintenance Grafana Istio Changes in kubernetes How will we benefit from introducing Istio? Istio automatically injects a Sidecar What does the Sidecar do? Kiali dashboard Developer Guide Java Jenkins Jenkinsfile Jmeter Kafka Maintenance Kafka @Sbab User Guide Kafka Connect Kubectl Access Kubernetes Lab environment Local Open Web Metrics infrastructure MongoDB Netbox NVIDIA Neo4J Sonatype Nexus repository Oracle OWASP Database OWASP @Sbab User Guide Pact Principles of Security Prometheus ReactJS Redis Renovate S3 Security Guidelines for Developers Sentry Maintenance Sentry User Guide Configuring Variables for Services Deployed to Kubernetes Software Architecture SonarQube Maintenance SonarQube User Guide Structurizr System Landscape Vagrant Zipkin Windows Pipelines SBAB Docs » Istio View page source Istio ï As a part of our work towards implementing Zero trust in our Kubernetes environment, we did a lot of research
and came to the conclusion that Istio - Service Mesh is our best option. Note If you want to read more about Istio, they have a good documentation site Changes in kubernetes ï As of the time this is written [2022-12-09], our Kubernetes cluster setup does not restrict
any access between the services hosted there. Which could mean that if one service introduces
a security risk, all of our services might be vulnerable to the security threat. Here is a simple graph, showing how our current Kubernetes setup looks like
(for future reference) This setup works well, but is not a very safe way to go forward.
Instead of âZero Trustâ, it is âTrust All!â So what we are aiming too accomplish, is a system where all our services must define their specific
dependencies (both within and outside of Kubernetes). With this in mind, all services using e.g. Kafka and/or partner-auth-service must define these as
service dependencies in their service Git repository. How will we benefit from introducing Istio? ï That is a great question. We could simply use Kubernetes NetworkPolicies for setting up Access control between services. While the Network Policies of Kubernetes works well, they do not allow
much more control than ALLOW / DENY, and they work as strictly as a Firewall. If a service is denied access through a Network Policy (OSI Layers 3 and 4), it will be refused to even connect to a
port, or seeing if the other service is running or not. By using the Istio Authorization Policy (OCI Layer 7), not only
do we get a much more customizable way of setting up access rules, we also will be able to connect to the other services
and get expected responses, or the response âRBAC: access deniedâ, which actually shows you what is going on, and why you
are not allowed access to the requested service/resource. Istio will also provide us with an out-of-the-box solution for request tracing, monitoring and it also provides good
observability through the Kiali dashboard Istio automatically injects a Sidecar ï So, when deploying a service to our Kubernetes cluster, we usually just get a pod, with one single container running
the service software itself. With Istio, we will get automatic injection of a second container, called the Sidecar. This will make the Kubernetes graph look something like this What does the Sidecar do? ï The Istio Sidecar container will take over the network of the entire Pod, and setup an internal proxy inside of it.
The Sidecar proxy will be listening to the Service port, and then forward (or deny) the incoming requests. All outgoing network traffic, from the Pod will also go through the Sidecar. This is a way for us to control the
security of network traffic between services. This way, services wonât need to care about TLS certificates and common
authorities, as that will all be handled by the Sidecar. Here is a simple graph, depicting how the Sidecar works Kiali dashboard ï Note If you want to read more about Kiali, istio provides a good documentation site For e.g. the sys environment, in ki (Kista datacenter), we can access the Kiali dashboard, using the
following link https://k8sproxy-ki.sys.sbab.se/kiali/ In the Kiali Dashboard, a lot of data will become visible. You will be able to see all deployments
running in the different namespaces of Kubernetes. When the Istio setup is complete in our environments
we will also be able to see how our internal service communicate, by request tracing (e.g. Zipkin). Developer Guide ï In order for us to truly achieve a Zero trust environment in K8S, there are some changes that are needed
from the developers of the microservices as well. We, in Team TNT, are aiming for those changes to be minimal. The changes needed for the services will only be needed in the project repoâs .gitlab-ci.yml file.
All the serviceâs used by your software will need to be listed, in a variable, as follows: 1 --- 2 variables : 3 SERVICE_DEPENDENCIES : > 4 kafka 5 oracle 6 redis 7 schema-registry 8 account-service 9 e-signing-service Note It is very important that the formatting of the service dependency list is done exactly as above. As Gitlab
CI does not allow variables to be e.g. Yaml lists. The > character will replace all the newlines with
spaces, to make a space separated list for Ansible to use during deployment. In the list above, kafka, oracle and redis are services outside of K8S, but will be made available for your
service deployment by adding them to the list. Service external to K8S, currently available, are the following: Name Description kafka All the Kafka brokers oracle Oracle DB redis All redis nodes Note For all other services, inside Kubernetes, you will simply need to append their name to the list. Previous Next © Copyright 2024, TNT. Built with Sphinx using a theme provided by Read the Docs .