GitLab @Sbab User Guide — SBAB Docs  documentation SBAB Docs Ansible Controller Ansible Roles Ansible Vault Argo Workflows Authentication & Authorization Bitbucket Boost Chatbot Booli Ceph Dex Fortigate troubleshooting Generate certificate Go GitHub Copilot GitLab @Sbab User Guide Migrate from stash/jenkins Deployment procedure to production Jira check status passed Jira check status failed tnt/pipelines Trunk Based Development Deploy from dev branch to ACC Skip prod deployment Java Java multi-module services JavaScript Node Static apps Front-end testing Common services Golang Python Package managers OS dependencies Private Repositories at SBAB Tools Java Batches Python Batches Enable trunk based deployment for batches Configure Memory limits for Batch jobs Libraries Java Libraries Java multi module libraries Go Libraries JavaScript Libraries Python Packages Battre-boende Partalen-app Integration tests Kafka Schemas API Linter Prometheus metrics Slack notifications Namespaces Docker integration tests External cluster HashiCorp Vault Retrieving variables from Hashicorp Vault during the build process Helm Fleet management Automatic version bump Restricted repositories Project templates Repo event notifications Slack integration Restart Micro Service Redeploy a Micro Service Remove a Micro Service Scheduled security scanning GitLab Maintenance Grafana Istio Java Jenkins Jenkinsfile Jmeter Kafka Maintenance Kafka @Sbab User Guide Kafka Connect Kubectl Access Kubernetes Lab environment Local Open Web Metrics infrastructure MongoDB Netbox NVIDIA Neo4J Sonatype Nexus repository Oracle OWASP Database OWASP @Sbab User Guide Pact Principles of Security Prometheus ReactJS Redis Renovate S3 Security Guidelines for Developers Sentry Maintenance Sentry User Guide Configuring Variables for Services Deployed to Kubernetes Software Architecture SonarQube Maintenance SonarQube User Guide Structurizr System Landscape Vagrant Zipkin Windows Pipelines SBAB Docs » GitLab @Sbab User Guide View page source GitLab @Sbab User Guide ï GitLab is our CI/CD system, maintained by #team-tnt . Membership to groups and projects is administered by service-desk . Team managers and product owners have admin rights in groups and projects. Also they can force deployments to production. GitLab Learn has free educational courses on how to use GitLab. Migrate from stash/jenkins ï Note Stash and Gitlab uses some different terms: âProjectâ in Gitlab is the same as âRepositoryâ in Stash. âGroupâ in Gitlab is the same as âProjectâ in Stash. Gitlab replaces both Stash and Jenkins. Gitlab handles both source-control and pipelines.
The pipeline for a Gitlab project is set up by adding a .gilab-ci.yml file at the root of your project.
Follow the below steps to migrate a repository from stash: Create a new project in your group Choose âImport projectâ Choose to import from âBitbucket serverâ Provide url https://stash.sbab.se/ and your private stash login credentials Find the repo you want to import and choose to which group you want to import it Start the import Add the .gilab-ci.yml file that fits your project Deployment procedure to production ï To deploy to production there is a step that checks that commit messages
include a Jira ID. It also checks so that those jira tickets are in the correct status (âReady for deployâ or âDoneâ). Jira check status passed ï The developer can proceed by clicking the âDeploy/Force deployâ play button. If the deploy is successful, the status for the entire pipeline will be marked as passed. Jira check status failed ï See the log of the âCheck Jira Statusâ step for more information. You have two options. Fix those problems, rerun the âCheck Jira Statusâ step and then manually trigger the prod deploy. Ask a product owner or manager to force the prod deploy. This requires that the PO/manager belongs to the âapprove-production-releaseâ group ( id.sbab.ad ) and is apart of the Gitlab group âTeam managers and product ownersâ (which can be requested via service-desk ). The status for the pipeline will then be like this: tnt/pipelines ï The tnt/pipelines project supports different types, e.g Java and Node. .gitlab-ci.yml is a file that lives in the root of each repository, which setups the pipeline. Trunk Based Development ï The default workflow at SBAB is to use a dev branch in order to deploy to Sys and master branch for deploying to our other environments. Trunk Based Development, i.e merging feature branches directly to master and deploying to Sys, can be enabled using the TRUNK_BASED variable. .gitlab-ci.yml ï --- variables : TRUNK_BASED : "true" Deploy from dev branch to ACC ï It is now possible to deploy to ACC environment from dev branch using DEPLOY_TO_ACC_FROM_DEV variable. .gitlab-ci.yml ï --- variables : DEPLOY_TO_ACC_FROM_DEV : "yes" Skip prod deployment ï Production deployment can be skipped using below variable. .gitlab-ci.yml ï --- variables : SKIP_PROD_DEPLOY : "yes" Java ï Supported Java versions (Corretto): 8, 11, 17 and 21 In this example, we will use Amazon Corretto , also with Java 17 .gitlab-ci.yml ï --- variables : JAVA_VERSION : "17" include : - project : tnt/pipelines file : java/Maven.corretto.gitlab-ci.yml ref : $TNT_PIPELINES_REF Corretto: https://hub.docker.com/_/amazoncorretto Java multi-module services ï Important There is some additional information of how you will need to configure your projects
in the Java multi module libraries section further down in this document. If you have a Java service with e.g. an API module, which would be good to publish to nexus.
Instead of using the IS_LIBRARY variable, you should use the SERVICE_MODULE variable set to the name
of the module that should be deployed as a service to Kubernetes.
This will deploy your Java service to K8S, as usual, and also publish libraries to nexus .gitlab-ci.yml ï --- variables : JAVA_VERSION : "17" SERVICE_MODULE : "my-super-service" include : - project : tnt/pipelines file : java/Maven.corretto.gitlab-ci.yml ref : $TNT_PIPELINES_REF Note Please, add the maven.deploy.skip in the pom.xml of your service module.
This will prevent the service jar from being deployed to Nexus. JavaScript ï Supported package managers: npm yarn pnpm Node ï Supported Node versions: 18 and 20 Version 18 was the LTS version and will be end-of-life 2025-04-30.
Version 20 is the current LTS and will be end-of-life 2026-04-30. In this example, the pipeline will build a Node micro service using npm to the backend namespace .gitlab-ci.yml ï --- variables : NAMESPACE : "backend" NODE_VERSION : "18" include : - project : tnt/pipelines file : node/npm.gitlab-ci.yml ref : $TNT_PIPELINES_REF The below example shows how to use yarn instead of npm .gitlab-ci.yml ï --- variables : NAMESPACE : "frontend" NODE_VERSION : "18" include : - project : tnt/pipelines file : node/yarn.gitlab-ci.yml ref : $TNT_PIPELINES_REF When using pnpm .gitlab-ci.yml ï --- variables : NAMESPACE : "frontend" NODE_VERSION : "18" include : - project : tnt/pipelines file : node/pnpm.gitlab-ci.yml ref : $TNT_PIPELINES_REF Static apps ï In this example, the pipeline will build a static micro service using npm .gitlab-ci.yml ï --- variables : NODE_VERSION : "18" include : - project : tnt/pipelines file : static/npm.gitlab-ci.yml ref : $TNT_PIPELINES_REF The below example shows how to use yarn instead of npm .gitlab-ci.yml ï --- variables : NODE_VERSION : "18" include : - project : tnt/pipelines file : static/yarn.gitlab-ci.yml ref : $TNT_PIPELINES_REF When using pnpm .gitlab-ci.yml ï --- variables : NODE_VERSION : "18" include : - project : tnt/pipelines file : static/pnpm.gitlab-ci.yml ref : $TNT_PIPELINES_REF ReactJS ï If your static app is build in react and should be embedded as a
component in Sitevision, you should add the variable DO_INIT_BASE to your pipeline definition, like this .gitlab-ci.yml ï --- variables : DO_INIT_BASE : "true" NODE_VERSION : "18" include : - project : tnt/pipelines file : static/yarn.gitlab-ci.yml ref : $TNT_PIPELINES_REF Front-end testing ï This pipeline can be used to run an end to end frontend testing. In case of failure a job artifact with test result,
screenshots and videos will be created which can be browsed or downloaded from job view. There are two custom optional variables which can be used: TEST_ARTIFACT_PATH: Set the folder to be included in the artifact (default cypress) TEST_COMMAND: which test command to run (default for npm: âtestâ and for yarn: âtest ââ) CI yaml file for npm .gitlab-ci.yml ï --- variables : TEST_COMMAND : "command to run" NODE_VERSION : "18" include : - project : tnt/pipelines file : js-test/npm.gitlab-ci.yml ref : $TNT_PIPELINES_REF The below example shows how to use yarn instead of npm .gitlab-ci.yml ï --- variables : TEST_COMMAND : "command to run" NODE_VERSION : "18" include : - project : tnt/pipelines file : js-test/yarn.gitlab-ci.yml ref : $TNT_PIPELINES_REF Common services ï To deploy a Java service in our common cluster, e.g. a Corretto 11 service .gitlab-ci.yml ï --- variables : JAVA_VERSION : "11" include : - project : tnt/pipelines file : tools/java/Maven.corretto.gitlab-ci.yml ref : $TNT_PIPELINES_REF Golang ï In this example, the pipeline will build a Golang micro service .gitlab-ci.yml ï --- include : - project : tnt/pipelines file : golang/.gitlab-ci.yml ref : $TNT_PIPELINES_REF Python ï In this example, the pipeline will build a Python micro service. .gitlab-ci.yml ï --- include : - project : tnt/pipelines file : python-v2/.gitlab-ci.yml ref : $TNT_PIPELINES_REF Make sure the structure of your project follows the SBAB standard example-python-project ï âââ src
â   âââ api
â   â   âââ __init__.py
â   â   âââ config.py
â   â   âââ log.py
â   â   âââ main.py
â   â   âââ routers
â   â       âââ __init__.py
â   â       âââ admin.py
â   â       âââ base.py
â   âââ other_python_module
â       âââ __init__.py
â       âââ foo.py
â       âââ bar
â           âââ __init__.py
â           âââ baz.py
âââ tests
â   âââ api
â   â   âââ test_admin.py
â   â   âââ test_middleware.py
â   âââ conftest.py
âââ main.sh
âââ README.md
âââ requirements.txt*
âââ pyproject.toml*
âââ poetry.lock*
âââ setup.py* Package managers ï The python-v2 pipeline supports both pip and Poetry as package managers. By default, pip is used. To use Poetry, set the USE_POETRY variable in your .gitlab-ci.yml file. Example: variables : - USE_POETRY : true OS dependencies ï It is not possible to use a custom Dockerfile for python projects. However we have a set of base images that can be used to build your project.
In order to use another base image than the standard one, you need to add the following variable to your pipeline definition: .gitlab-ci.yml ï --- variables : OS_DEPENDENCIES : "<scope>" We currently support the following base images for python projects. Value Description "base" Almalinux image with Python installation (3.9/3.11). Standard "pyodbc" Oracle instant client + packages needed for connecting to MSSQL Server "tesseract" Packages required for running Tesseract OCR "pyspark" JAR-files containg Delta Lake JARs (core/storage) as well as Hadoop It is possible to specify the Python version to use by setting the PYTHON_VERSION variable. We currently support 3.9 and 3.11 with the latter being the default. Private Repositories at SBAB ï By default, all python projects will have access to the following private repositories: python-libaries - self hosted default repository for SBABs own packages pypi-all - proxy repository for pypi.org These are grouped into a common endpoint: https://nexus.common.sbab.se/repository/pypi-public/simple To gain access to a private SBAB repository, you should include the URL in the dependency management file. For poetry projects: Add the repository as a supplemental source in your pyproject.toml file. pyproject.toml ï [[tool.poetry.source]]
name = "<private-repo>"
url = "https://nexus.common.sbab.se/repository/<private-repo>/simple"
priority = "supplemental" For pip projects: Add an extra index url in your requirements.txt file. In order for Gitlab to be able to authenticate against the repository, the url should be in the following format: requirements.txt ï --extra-index-url=https://${PYPI_REPOSITORY_USERNAME}:${PYPI_REPOSITORY_PASSWORD}@nexus.common.sbab.se:8443/repository/<private-repo>/simple For publishing python packages to a private repository at SBAB, see the Python Packages section. Setting up a private repository at SBAB must be done by #team-tnt . Please contact them if you need help with this. Tools ï There are normally a few things that is needed to set up a tool: You need to have a valid .gitlab-ci.yml, see example below. Set up if you want to use service_ingress_pathprefix (i.e. sbab.se/<your path>) or service_ingress_hostprefix (i.e. <your path>.sbab.se) in k8s_service_deploy Run your pipeline and deploy (normally to oscommon). Create jira a task for IOPS to make a new cert. Contact TnT to get help updating the proxy and create a DNS record. To deploy a tool service that uses a custom Dockerfile to the oscommon-cluster .gitlab-ci.yml ï --- include : - project : tnt/pipelines file : tools/docker/.gitlab-ci.yml ref : $TNT_PIPELINES_REF Java Batches ï In this example, the pipeline will test, build and register the Java batch job in batch-runner .
The rest of the pipeline looks like a regular Java pipeline .gitlab-ci.yml ï --- variables : BATCH_NAME : "<name of batch job in Argo/Robot>" Python Batches ï In this example, the pipeline will test, build and register the Python batch job in batch-runner .
The rest of the pipeline looks like a regular Python pipeline .gitlab-ci.yml ï --- variables : BATCH_NAME : $CI_PROJECT_TITLE Enable trunk based deployment for batches ï Enabling trunk based deployments for batches does the same as trunk based deployments for microservices.
Brings the ability to deploy your batch to SYS from the master branch (default is to deploy to SYS from dev branch only) To enable this add the TRUNK_BASED_BATCH variable to your gitlab-ci file: .gitlab-ci.yml ï --- variables : TRUNK_BASED_BATCH : "true" Configure Memory limits for Batch jobs ï Per default, batch jobs will receive a memory limit of 4096M. This can be overridden by setting the following variable to an integer between 1 and 8000: --- variables : BATCH_MEMORY_LIMIT : "8000" Libraries ï A library pipeline is similar to a regular pipeline, you just need to add the variable IS_LIBRARY .gitlab-ci.yml ï --- variables : IS_LIBRARY : "yes" Java Libraries ï A Java library pipeline is similar to a Java pipeline and only needs the IS_LIBRARY variable. Pushing the code to dev branch will automatically upload the latest snapshot to maven-snapshots repository. To deploy to maven-releases repository you need first merge the code to master branch and then tag your release (in master branch) manually in GitLab.
A new deployment pipeline will be automatically created for the new tag. When choosing a tag, please make sure that it follows Semantic versioning convention. Java multi module libraries ï You will need to add an extra module for the sonar reports. In the pom for that new module,
add the other modules as dependencies and use the aggregate goal like this Partial pom.xml ï ... <build> <plugins> <plugin> <groupId> org.jacoco </groupId> <artifactId> jacoco-maven-plugin </artifactId> <version> ${jacoco.version} </version> <executions> <execution> <id> report-aggregate </id> <phase> verify </phase> <goals> <goal> report-aggregate </goal> </goals> </execution> </executions> </plugin> <plugin> <groupId> org.owasp </groupId> <artifactId> dependency-check-maven </artifactId> <version> ${owasp.version} </version> <configuration> <reportSets> <reportSet> <reports> <report> aggregate </report> </reports> </reportSet> </reportSets> </configuration> </plugin> </plugins> </build> In the parent pom of the library, add the following under <properties> Partial pom.xml ï <properties> <sonar.coverage.jacoco.xmlReportPaths> ${project.basedir}/[YOUR REPORT MODULE]/target/site/jacoco-aggregate/jacoco.xml </sonar.coverage.jacoco.xmlReportPaths> <sonar.dependencyCheck.jsonReportPath> ${project.basedir}/[YOUR REPORT MODULE]/target/dependency-check-report.json </sonar.dependencyCheck.jsonReportPath> <properties> Go Libraries ï The pipeline for a Golang library is similar to a Golang pipeline and only needs the IS_LIBRARY variable. JavaScript Libraries ï The pipeline for a Javascript library is similar to a JavaScript pipeline and only needs the IS_LIBRARY variable. .gitlab-ci.yml ï --- variables : NODE_VERSION : "18" IS_LIBRARY : "yes" include : - project : tnt/pipelines file : node/<npm | pnpm | yarn >.gitlab-ci.yml ref : $TNT_PIPELINES_REF The version of the library must be defined in the package.json file and must follow the Semantic versioning convention . Python Packages ï The pipeline for a Python package is also similar to a Python pipeline and needs the IS_LIBRARY variable.
An example of this is the ds-template-python-package package. Packages can be published from the dev and master branches. The new version is declared in setup.py , make sure that it follows Semantic versioning convention.
Packages that are published from the dev branch will have the suffix dev0 in the version number, i.e 0.1.0.dev0 . We do not currently support incremental dev-releases, i.e 0.1.0.dev0 0.1.0.dev1 etc. Make sure to read Picking A Name when setting up your package, no hypens ( - ) in the package name. If you want to publish to a private repository at SBAB, add the following to your .gitlab-ci.yml-file: .gitlab-ci.yml ï --- variables : NEXUS_PYPI_REPOSITORY : "<name of private repository>" Battre-boende ï Feature and dev branch of battre-boende can be deployed to our test environment (sysi{2..10}) when running the pipeline manually. Partalen-app ï Feature and dev branch of partalen-app can be deployed to our test environment (sysi{1..10}) when running the pipeline manually. Integration tests ï Partalen-app integration tests runs only when building the master branch towards sys environment.
The pipeline will fail if there are any test failures in integration test step. If you want to build master branch manually,
please choose set SYS_ENVIRONMENT to sysi1 . Kafka Schemas ï The Kafka Schema pipeline is similar to a Java pipeline and only needs the IS_KAFKA_SCHEMA variable. In order to register the schema in each schema registry, you need first merge the code to master branch and then tag your release (in master branch) manually in GitLab.
A new deployment pipeline will be automatically created for the new tag. When choosing a tag, please make sure that it follows Semantic versioning convention. .gitlab-ci.yml ï --- variables : JAVA_VERSION : "11" IS_KAFKA_SCHEMA : "yes" include : - project : tnt/pipelines file : java/Maven.corretto.gitlab-ci.yml ref : $TNT_PIPELINES_REF API Linter ï If your application does provide an OpenAPI specification in the pipeline, you need to specificy if you want to enable the API linter by âoptionalâ or ârequiredâ with API_LINTER variable. The purpose of ârequiredâ would be for new services that we really want to fulfill the API Guidelines . The purpose of âoptionalâ would be for old services to see what recommendations API linter have and in which requirement levels. .gitlab-ci.yml ï --- variables : JAVA_VERSION : "17" API_LINTER : "optional" include : - project : tnt/pipelines file : java/Maven.corretto.gitlab-ci.yml ref : $TNT_PIPELINES_REF Prometheus metrics ï If your application exports metrics for Prometheus/Grafana, you need to specify what URL path should be scraped with SERVICE_SCRAPE_PATH Partial .gitlab-ci.yml ï --- variables : SERVICE_SCRAPE_PATH : "/spring-template/admin/prometheusMetrics" Slack notifications ï Note Slack webhooks used by GitLab are created in https://api.slack.com/apps/A021P5TTJUF/incoming-webhooks . To configure Slack notifications when a production deployment fails: Contact #team-tnt and ask to create a new webhook for your teamâs channel Specify the SLACK_WEBHOOK variable Partial .gitlab-ci.yml ï --- variables : SLACK_WEBHOOK : "https://hooks.slack.com/services/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" Namespaces ï Note Contact #team-tnt before overriding the namespace. Standard namespaces Location Description "backend" Backend services "frontend" Internal frontend services which are accessible through the Secure Web "frontend-external" Frontend services which are directly accessible from the outside world "tools" All tools used to build, test and monitor applications If you want to override and deploy to a custom namespace in Kubernetes, use the NAMESPACE variable Partial .gitlab-ci.yml ï --- variables : NAMESPACE : "booli" Docker integration tests ï Note This is currently only supported in Java pipelines. If your project is using testcontainers, the LEGACY_DOCKER variable needs to be set Partial .gitlab-ci.yml ï --- variables : LEGACY_DOCKER : "yes" External cluster ï Set the EXTERNAL_DEPLOY variable if the service should be deployed to the external cluster Partial .gitlab-ci.yml ï --- variables : EXTERNAL_DEPLOY : "true" This is currently used by: partner-auth-service #initiativ-mekanismen HashiCorp Vault ï The path for HashiCorp Vault secrets in the external cluster: Namespace Path Dev prod/k8s/ext/dev Master prod/k8s/ext/master Retrieving variables from Hashicorp Vault during the build process ï To incorporate variables required during the microserviceâs build stage within the pipeline, follow these steps: Create a dedicated folder in Vault under test/k8s/build-vars/variables/ for the service, name mirroring the service name. Add the variables needed under the folder belonging to the service Include the FETCH_BUILD_SECRETS variable set as true in your gitlab-ci.yml file. .gitlab-ci.yml ï --- variables : FETCH_BUILD_SECRETS : "true" The variables will now be injected into the pipeline with the name of the variable being the key. Helm ï To deploy a helm chart in Sys/Acc/Stage/Prod .gitlab-ci.yml ï --- variables : SERVICE_NAMESPACE : <service_namespace> include : - project : tnt/pipelines file : helm/.gitlab-ci.yml ref : $TNT_PIPELINES_REF Fleet management ï To minimize the manual work needed for updating dependencies in java-services and javascript-apps you can set up your service
to be handled by SBABâs fleet management. For more information about the fleet management concept, see for example here . For services/apps using fleet management the deployment of dependency updates triggered by Renovate can be done
automatically. As of now the deployment is automated for SYS, ACC and STAGE environments (the deployment to prod needs
to be triggered manually), but the long-term aim is to be able to deploy to PROD environment as well. Note If you decide to use fleet-management for your app/service, it canât simultaneously be handled by our standard renovate-runner . Conflicts will occur. Fleet-runner will create two separate merge requests for master and dev branches. By doing this only renovate
changes will be deployed, i.e. no dev changes in master pipeline. Note Consider if your service/app is suitable for automated deployments. For example, does it have good enough tests to be
deployed automatically to STAGE? Also note that fleet management might not work as well in repos where there is ongoing development (i.e. the dev
branch and master branch has different code content). To enable fleet management in a repo follow below steps: Add users renovate , TNT Service Account and Auto Approver to your group. Allow TNT Service Account to âpush and mergeâ to dev-branch Settings-> Repository-> Protected branches The dev-branch needs to be set as the default branch Settings-> Repository-> Branch defaults Uncheck âPrevent editing approval rules in merge requestsâ Settings-> Merge requests Add a renovate.json file renovate.json ï { "maven" : { "enabled" : true }, "platformAutomerge" : true , "hostRules" : [ { "hostType" : "maven" , "baseUrl" : "http://nexus.common.sbab.se:8081/repository/maven-public/" } ], "packageRules" : [ { "groupName" : "all dependencies" , "groupSlug" : "all" , "matchPackagePatterns" : [ "*" ], "matchUpdateTypes" : [ "minor" , "patch" ], "automerge" : true , "gitLabIgnoreApprovals" : true }, { "managers" : [ "maven" ], "registryUrls" : [ "http://nexus.common.sbab.se:8081/repository/maven-public/" ] } ], "rangeStrategy" : "bump" , "commitMessagePrefix" : "TNT-5191 Fleet management" , "$schema" : "https://docs.renovatebot.com/renovate-schema.json" } Note Do not change the commitMessagePrefix . It should be set to âTNT-5191 Fleet managementâ for all teams Add your repository to repos.txt . Keep you teams repos next to each other in the list. If you wish to receive slack notifications regarding results from the dependency scan and the progress of the fleet pipelines you will need
to provide the variable FLEET_MANAGEMENT_SLACK_WEBHOOK by setting it as a CI/CD variable in the setting for your project. See Slack notifications for information regarding webhooks. Automatic version bump ï Renovate supports running tasks, called postUgradeTasks after it has updated dependencies but before it creates a merge request.
This can be utilized to automatically bump the version of your library/module. renovate.json ï { "postUpgradeTasks" : [ { "task" : "poetry version patch" } ] } The above example will bump the version of your python library with a patch version, e.g. from 1.0.0 to 1.0.1, and include that in the merge request. postUpgradeTasks must be enabled by adding them to the global configuration in the fleet-runner repository . Note Ensure that the command you execute doesnât alter the git repository. For instance, when running npm version patch , use the --no-git-tag-version flag. We have noticed that the lockfileMaintenance property in renovate.json does not invoke the postUpgradeTasks, so we recommend using the postUpgradeTasks property for also updating the lockfile. Restricted repositories ï In order for the renovate runner to be able to check for updates in repositories with restricted access, you need to explicitly add credentials for that repository in the renovate.json file.
Contact #team-tnt and they will provide you with a set of encrypted credentials that you can add to the renovate.json file in your repository. renovate.json ï { "hostRules" : [ { "matchHost" : "https://nexus.common.sbab.se:8443/repository/<restricted repository>" , "encrypted" : { "username" : "<encrypted username>" , "password" : "<encrypted password>" } } ] } Project templates ï You can choose to use a template when creating a new project , just press âCreate from templateâ and then the âInstanceâ tab.
There are SBAB templates for some different languages/frameworks.
You will need to do some modifications: Add a suitable .gitlab-ci.yml, see Migrate from stash/jenkins Spring boot: Modify pom (e.g. artifactid same as project name, description, etc) Adjust the env.list files Adjust package name Repo event notifications ï Gitlab supports notifications for repository events such as creation of
Merge requests, Deployments and Pipeline results. Slack integration ï To turn on Slack notifications, for e.g. Merge Requests, in your
project or group you need to follow the following steps. Contact #team-tnt and ask to get a webhook for your channel: https://api.slack.com/apps/A021P5TTJUF/incoming-webhooks Go to your project/group page In the left side menu, go to Settings -> Integrations Find and click on the Slack notifications link Read more about how to set this up in the Gitlab Documentation (link below) https://gitlab.sbab.se/help/user/project/integrations/slack Restart Micro Service ï To restart a micro service running in any of our clusters: Navigate to the tools/restart-micro-service pipeline Set correct values for ENV_NAME , SERVICE_NAME and SERVICE_NAMESPACE as per the instructions in the UI Click the Run pipeline button Redeploy a Micro Service ï To redeploy a microservice for any reason, e.g deploy updated secrets in Hashicorp Vault: Navigate to latest pipeline for your Gitlab-project, CI/CD -> Pipelines Find the pipeline-step that deploys the service to the targeted environment and click Retry This option is only available for 30 days after a pipeline has run. To trigger a new pipeline in order to redeploy a service: Navigate to the pipeline section in your Gitlab-project, CI/CD -> Pipelines Click Run pipeline and select the targeted branch to run a pipeline for. Remove a Micro Service ï To remove a microservice that is no longer used in a specific environment: Go here , specify all the input values and run the pipeline The SERVICE_GROUP_ID can be found under your group, e.g.: If you are removing a micro service from production environment, ask your team manager or product owner for approval. Scheduled security scanning ï You can setup a scheduled security scan for you java services/libraries.
Send in the ONLY_SECURITY_SCAN variable to only run the sonar/owasp part of the pipeline.
Choose a random time in the weekend (using cron syntax) when your team runs your scans, and configure your
teams schedules to run with 20 sec between them. This should be done to spread out the load
and lower the risk of running out of resources which could happen if all teams run their scheduels at the same time. Previous Next © Copyright 2024, TNT. Built with Sphinx using a theme provided by Read the Docs .