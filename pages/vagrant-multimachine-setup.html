Multi-machine setup — SBAB Docs  documentation SBAB Docs Ansible Controller Ansible Roles Ansible Vault Argo Workflows Authentication & Authorization Bitbucket Boost Chatbot Booli Ceph Dex Fortigate troubleshooting Generate certificate Go GitHub Copilot GitLab @Sbab User Guide GitLab Maintenance Grafana Istio Java Jenkins Jenkinsfile Jmeter Kafka Maintenance Kafka @Sbab User Guide Kafka Connect Kubectl Access Kubernetes Lab environment Local Open Web Metrics infrastructure MongoDB Netbox NVIDIA Neo4J Sonatype Nexus repository Oracle OWASP Database OWASP @Sbab User Guide Pact Principles of Security Prometheus ReactJS Redis Renovate S3 Security Guidelines for Developers Sentry Maintenance Sentry User Guide Configuring Variables for Services Deployed to Kubernetes Software Architecture SonarQube Maintenance SonarQube User Guide Structurizr System Landscape Vagrant Zipkin Windows Pipelines SBAB Docs » Multi-machine setup View page source Multi-machine setup ï As a part of the Ansible project, we provide a Vagrant setup directory, which can be used
to setup test-vmâs on your local machine for debugging and testing while developing. Prerequisites ï To be able to use this setup, you must install software on your local machine for running
Vagrant. Install Vagrant. Please, see the Vagrant documentation , for installation guides Install VirtualBox. Please, see the Virtualbox documentation , for installation guide Install Vagrant plugins needed for running out Multi-machine setup, to do this
please run the command below in a Terminal / Command-prompt: vagrant plugin install vagrant-hostmanager \ vagrant-proxyconf \ vagrant-share \ vagrant-vbguest Important Environment Variables ï Listed below are some environment variables that are important to know about, and to consider
while setting up your test-vmâs. Most of which, have the purpose to point vagrant to your local
source code directory for the software you are testing/debugging, which will allow you to test
your own local code changes. NGINX_SOURCE path to LGC/nginx repo checkout MODSECURITY_SOURCE path to SAK/modsecurity repo checkout WEBBEN_SOURCE path to LGC/webben repo checkout IS_DOMAIN_ROOT path to LGC/is-domain repo checkout IS_DOMAIN_TEMPLATE_ROOT path to LGC/is-domain-template repo checkout IS_EXTCOMP_ROOT path to LGC/is-extcomp repo checkout Note These environment variables needs to be set on your local machine, and not on any of the vms created by vagrant. Ansible Controller ï The first machine to setup is the Ansible-controller, this is used to setup and configure
all other machines in the Vagrant setup. This VM is important, since it will use Ansible to configure other vm instances, and deploy and configure the correct software. To create and start this vm on your local machine, you will need to run the following
command in your Terminal/Command-prompt: Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant up ansible Running this command will take a while, since it will create the Virtual Machine needed before
installing and configuring Ansible and the needed keys and config for running Ansible deployments
on other local vms, or remote machines in our testing environments. When the setup of the vm is finnished, you can login to the machine by running Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant ssh ansible Congrats! Now you are in the environment from which you will be able to setup and configure other local
vms for local testing and debugging of some of our software. Log out by pressing Ctrl+D , because before attempting to setup any other vm, you will need to run vagrant up $vm for
the machines you need running locally. This is required to be able to test and debug your local changes (replace $vm with the name of the vm you want to deploy). Secure & Open Web ï Note Before using this, please make sure to setup the Ansible Controller first! To set up a local deployment of Secure or Open Web to test and debug your code changes, you will need
to follow some specific steps to get it up and running with Sitevision inside a VM. As the steps to set this up are almost exactly the same for both Open and Secure web, we combine these two inside
this single guide. Deployment ï Note If your reason to set up Secure and Open Web locally is to test your local source code revision, you will
need to set the WEBBEN_SOURCE environment variable, to point to your local directory containing
the source code of Webben. To create the virtual machine to run on, you will need to execute one of the following commands: Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant up sec # secure web vagrant up www # open web This will only create the vm, with the correct OS and configuration to allow secure web to be installed. Now you will need to login to the Ansible Controller by executing the following: Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant ssh ansible Once inside the Ansible Controller , the login message will announce a list of possible command aliases
the alias you should use is sec for Secure web and www for Open web, you can use these aliases by
simply executing them as commands in the Ansible Controllers shell. The alias commands maps to much longer ansible-playbook commands, so the execution will run for a while.
After running your alias command, you should have successfully deployed and installed your local copy of Secure
or Open web. Note It is possible to have both Open Web and Secure Web running on your local machine simultaneously You should be able to browse to your local installations by the following links Open Web http://sysi2.sbab.se Secure Web http://sysi2-ib.sbab.se Note Please refer to the projects readme for re-deploying changes in source code IS ï Note Before using this, please make sure to setup the Ansible Controller first! To set up a local deployment of IS to test and debug your code changes, you will need
to follow some specific steps to get it up and running with Weblogic inside a VM. Deployment ï Note If your reason to set up IS locally is to test your local source code revision, you will
need to set the IS_DOMAIN_ROOT environment variable, to point to your local directory containing
the source code of IS-Domain. To create the virtual machine to run on, you will need to execute one of the following commands: Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant up is This will only create the vm, with the correct OS and configuration to allow secure web to be installed. Now you will need to login to the Ansible Controller by executing the following: Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant ssh ansible Once inside the Ansible Controller , the login message will announce a list of possible command aliases
the alias you should use is is , you can use the alias by simply executing it as a commands in the Ansible
Controllers shell. The alias commands maps to much longer ansible-playbook commands, so the execution will run for a while.
After running your alias command, you should have successfully deployed and installed your local copy of Nginx. Note Please refer to the projects readme for re-deploying changes in source code Debugging ï To add debugging for your locally running IS instance in IDEA, you will need to follow these steps. Add a new Run configuration of the Remote type Input the necessary configuration options for your local instance Host is-dev-i1-1.sbab.se Port 5000 JDK 5 - 8 Remote JVM args -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5000 Module classpath Choose the module you want to debug It should look something like this, for debugging the www-open-services module: Nginx int/ext ï Note Before using this, please make sure to setup the Ansible Controller first! In all of our environments we have one internal and one external Nginx reverse proxy. The main difference between these
proxies is what should be reachable through them. The external proxy is used for traffic coming from the internet, while
the internal proxy should only be used for internal traffic. This way we should be able to better control what is reachable from the open internet. Deployment ï Note If your reason to set up Secure Web locally is to test your local source code revision, you will
need to set the NGINX_SOURCE and MODSEC_SOURCE environment variables, to point to your local directory
containing the source of our internal Nginx project. To create the virtual machine to run on, you will need to execute one of the following commands: Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant up nginx-int nginx-ext This will only create the vm, with the correct OS and configuration to allow secure web to be installed. Now you will need to login to the Ansible Controller by executing the following: Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant ssh ansible Once inside the Ansible Controller , the login message will announce a list of possible command aliases
the alias you should use is nginx , you can use the alias by simply executing it as a commands in the Ansible
Controllers shell. If you make changes to the configuration, that you would like to test locally, just take step 2 and 3 again, and the
configuration should be updated and Nginx instances should be reloaded. Kafka & Zookeeper ï Warning This vagrant setup seems to be outdated [2020-01-07], please contact Team TNT if this is
something you need for your local development environment. Most people use our Kafka
clusters in our sys environment for local testing. Tip To read about how to configure your kafka client, please see: Client configuration Note Before using this, please make sure to setup the Ansible Controller first! If you would want to run a single-node kafka machine on your local machine, for testing
kafka related things, you can use this Vagrant setup to achieve that. This Vagrant setup is intended to be a plug&play option, if you want to run outside of
our SBAB internal test environments. The setup is ideal if you do not want to clutter the
Kafka topics of your service with a lot of unwanted test records. To create the vmâs you can run Note Your current working directory has to be the ansible/vagrant directory before running any vagrant commands vagrant up kafka After creating the vm you will need to run the following in your Ansible-controller vm, for
Ansible to install and configure the Kafka and Zookeeper software. ansible-playbook -i inventory/test playbooks/kazoo.yml © Copyright 2024, TNT. Built with Sphinx using a theme provided by Read the Docs .