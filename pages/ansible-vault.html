Ansible Vault — SBAB Docs  documentation SBAB Docs Ansible Controller Ansible Roles Ansible Vault Encrypting the secret Using the secret Viewing secrets Decrypting secrets Editing secrets Further reading and access Argo Workflows Authentication & Authorization Bitbucket Boost Chatbot Booli Ceph Dex Fortigate troubleshooting Generate certificate Go GitHub Copilot GitLab @Sbab User Guide GitLab Maintenance Grafana Istio Java Jenkins Jenkinsfile Jmeter Kafka Maintenance Kafka @Sbab User Guide Kafka Connect Kubectl Access Kubernetes Lab environment Local Open Web Metrics infrastructure MongoDB Netbox NVIDIA Neo4J Sonatype Nexus repository Oracle OWASP Database OWASP @Sbab User Guide Pact Principles of Security Prometheus ReactJS Redis Renovate S3 Security Guidelines for Developers Sentry Maintenance Sentry User Guide Configuring Variables for Services Deployed to Kubernetes Software Architecture SonarQube Maintenance SonarQube User Guide Structurizr System Landscape Vagrant Zipkin Windows Pipelines SBAB Docs » Ansible Vault View page source Ansible Vault ï This document assumes you are using the Ansible Controller Vagrant machine. All secrets, vault files, in Ansible are encrypted YAML documents that decrypted looks like: inventories/ossys/group_vars/all/my-service-vault.yml ï --- vault_my_service_password : secret-password As you can see, the YAML file should be placed in the directory inventories/os<env>/group_vars/all/ . The name of the file should preferably contain the name of the microservice and end with -vault.yml . Encrypting the secret ï Encrypting for use in the test environments, ie: sys, acc and stage is as simple as running: [ vagrant@ansible ansible ] $ ansible-vault encrypt inventories/ossys/group_vars/all/my-service-vault.yml Note Obviously you need to do this for all the test environments, not only ossys To encrypt for use in the production environment you will need the vault password for production, it can be accessed through the (Hashicorp Vault)[ https://vault.sbab.se/ui/vault ]. [ vagrant@ansible ansible ] $ ansible-vault encrypt --encrypt-vault-id = prod --vault-id = prod@prompt inventories/osprod/group_vars/all/my-service-vault.yml Running this command will prompt you to enter the vault password for production. Using the secret ï Usually you will have an additional YAML file with the same filename without the -vault suffix, and this file will look something like: inventories/ossys/group_vars/all/my-service.yml ï --- my_service_username : NOT-SECRET-USERNAME my_service_password : "{{ vault_my_service_password }}" Finally you will reference these variables in your project like: config/sys/env.list ï DATABASE_USER ={{ my_service_username }} DATABASE_PASSWORD ={{ my_service_password }} Viewing secrets ï For test environments: [ vagrant@ansible ansible ] $ ansible-vault view inventories/ossys/group_vars/all/my-service-vault.yml For production you will need the password and then you can run: [ vagrant@ansible ansible ] $ ansible-vault view --ask-vault-pass inventories/osprod/group_vars/all/my-service-vault.yml Decrypting secrets ï For test environments: [ vagrant@ansible ansible ] $ ansible-vault decrypt inventories/ossys/group_vars/all/my-service-vault.yml For production you will need the password and then you can run: [ vagrant@ansible ansible ] $ ansible-vault decrypt --ask-vault-pass inventories/osprod/group_vars/all/my-service-vault.yml Editing secrets ï For test environments: [ vagrant@ansible ansible ] $ ansible-vault edit inventories/ossys/group_vars/all/my-service-vault.yml For production you will need the password and then you can run: [ vagrant@ansible ansible ] $ ansible-vault edit inventories/osprod/group_vars/all/my-service-vault.yml Further reading and access ï Access to the production vault can be requested through https://id.sbab.ad/ If this document is confusing maybe you will have better luck with: https://confluence.sbab.se/display/TSS/Add+a+new+database-password+to+production%27s+Ansible-vault Previous Next © Copyright 2024, TNT. Built with Sphinx using a theme provided by Read the Docs .